<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ç‚«é…·é˜…è¯»å™¨HUD</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #fdf6e3;
  margin: 0;
  padding: 0;
  color: #333;
}

/* ä¹¦ç±æ ‡é¢˜ä¸å†…å®¹ */
#bookTitle {
  text-align: center;
  padding: 18px;
  font-size: 23px;
  font-weight: bold;
}
#book {
  padding: 23px;
  font-size: 18px;
  line-height: 1.7;
  max-width: 800px;
  margin: 0 auto 500px auto; /* ç»™HUDç•™ç©ºé—´ */
}

/* ====== HUD å¤–å±‚å½©è™¹ç¯ ====== */
#outer-ring {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  width: 520px;
  height: 520px;
  border-radius: 50%;
  border: 8px solid transparent;
  background: conic-gradient(red, orange, yellow, green, blue, purple, red);
  animation: rotateOuter 20s linear infinite, colorShift 10s linear infinite;
  z-index: 899;
  pointer-events: none; /* ä¸é˜»æŒ¡ç‚¹å‡» */
}

/* ====== å†…åœˆå¯¼èˆª ====== */
#nav-circle {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  width: 460px;
  height: 460px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(16px);
  border: 3.5px solid rgba(255,255,255,0.5);
  box-shadow: 0 12px 32px rgba(0,0,0,0.4);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: visible;
}

/* å†…åœˆæ—‹è½¬å½©è™¹ç¯ */
.rotating-ring {
  position: absolute;
  top:50%;
  left:50%;
  width: 400px;
  height: 400px;
  border-radius: 50%;
  border: 4px solid;
  border-image: linear-gradient(90deg, red, orange, yellow, green, blue, purple, red) 1;
  transform: translate(-50%, -50%) rotate(0deg);
  animation: rotateRing 8s linear infinite, colorShift 8s linear infinite;
  z-index: 950;
  pointer-events: none;
}

/* ä¸­é—´é¥æ§å™¨åŒº */
.remote {
  position: relative;
  width: 100%;
  height: 100%;
}

/* ä¸­å¿ƒæ’­æ”¾æŒ‰é’® */
.btn-play {
  position: absolute;
  top:50%;
  left:50%;
  transform: translate(-50%, -50%);
  width: 150px;
  height: 150px;
  border-radius: 50%;
  font-size: 44px;
  font-weight: bold;
  background: #96dd13;
  border: 4px solid #e6c200;
  color: #191f1a;
  cursor: pointer;
  box-shadow: 0 0 28px rgba(39,192,28,0.95);
  z-index: 1005;
  transition: transform 0.2s ease, box-shadow 0.3s ease;
}
.btn-play:hover { transform: translate(-50%, -50%) scale(1.1); }

/* ç¯ç»•æŒ‰é’® */
.btn {
  position: absolute;
  width: 104px;
  height: 104px;
  line-height: 104px;
  border-radius: 50%;
  font-size: 25px;
  font-weight: bold;
  border: 2.3px solid rgba(255,255,255,0.6);
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(10px);
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: center;
  color: #222;
  box-shadow: 0 0 9px rgba(0,0,0,0.2);
}
.btn:hover { transform: scale(1.1); box-shadow: 0 0 18px rgba(0,0,0,0.45); }

/* æŒ‰é’®é¢œè‰² */
.btn-prev { background:#ff6b6b; border-color:#ff4c4c; color:#fff; }
.btn-next { background:#4ecdc4; border-color:#38b2ac; color:#fff; }
.btn-font-plus { background:#a29bfe; border-color:#6c5ce7; color:#fff; }
.btn-font-minus { background:#6c5ce7; border-color:#341f97; color:#fff; }
.btn-speed { background:#ff9ff3; border-color:#ff6f91; color:#000; }
.btn-theme { background:#81ecec; border-color:#00b894; color:#000; }
.btn-home { background:#fd79a8; border-color:#d63031; color:#fff; }
.btn-light { background:#ffe066; border-color:#ffb703; color:#000; }

/* æŒ‰é’®ä½ç½® */
.btn-prev { top:50%; left:5%; transform: translateY(-50%);}
.btn-next { top:50%; right:5%; transform: translateY(-50%);}
.btn-font-plus { top:8%; left:50%; transform: translateX(-50%);}
.btn-font-minus { bottom:8%; left:50%; transform: translateX(-50%);}
.btn-speed { top:18%; right:18%;}
.btn-theme { bottom:18%; left:18%;}
.btn-home { bottom:18%; right:18%;}
.btn-light { top:18%; left:18%;}

/* æŒ‰é’®æŒ‰ä¸‹æ•ˆæœ */
.btn:active, .btn:focus { box-shadow: 0 0 22px currentColor,0 0 45px currentColor,0 0 65px currentColor; }

/* å½©è™¹åŠ¨æ€åŠ¨ç”» */
@keyframes rotateRing { from{ transform: translate(-50%, -50%) rotate(0deg); } to{ transform: translate(-50%, -50%) rotate(360deg); } }
@keyframes colorShift { 0%{ filter:hue-rotate(0deg);} 100%{filter:hue-rotate(360deg);} }
@keyframes rotateOuter { from{ transform: translateX(-50%) rotate(0deg); } to{ transform: translateX(-50%) rotate(360deg); } }

</style>
</head>
<body>

<div id="bookTitle">åŠ è½½ä¸­...</div>
<div id="book"></div>
<div id="error" style="color:red;text-align:center;"></div>

<!-- å¤–å±‚å½©è™¹ç¯ -->
<div id="outer-ring"></div>

<!-- å†…åœˆå¯¼èˆª -->
<div id="nav-circle">
  <div class="remote">
    <!-- å†…åœˆæ—‹è½¬ç¯ -->
    <div class="rotating-ring"></div>

    <!-- ä¸­å¿ƒæ’­æ”¾æŒ‰é’® -->
    <button class="btn btn-play" id="play-btn" onclick="toggleAudio()">â–¶</button>

    <!-- ç¯ç»•æŒ‰é’® -->
    <button class="btn btn-prev" onclick="prevChapter()">â¬…</button>
    <button class="btn btn-next" onclick="nextChapter()">â¡</button>
    <button class="btn btn-font-plus" onclick="changeTextSize(2)">ğŸ”+</button>
    <button class="btn btn-font-minus" onclick="changeTextSize(-2)">ğŸ”-</button>
    <button class="btn btn-speed" id="speed-btn">1x</button>
    <button class="btn btn-theme" onclick="changeBackground()">ğŸŒˆ</button>
    <button class="btn btn-home" onclick="goBack()">ğŸ </button>
    <button class="btn btn-light" id="btn-light">âœ¨</button>
  </div>
</div>

<audio id="chapter-audio"></audio>

<script>
const audio = document.getElementById("chapter-audio");
const playBtn = document.getElementById("play-btn");
const speedBtn = document.getElementById("speed-btn");
const bookDiv = document.getElementById("book");

let speeds = [0.5,1,1.5,2];
let speedIndex = 1;
audio.playbackRate = speeds[speedIndex];

function toggleAudio() {
  if(!audio.src) return;
  if(audio.paused){
    audio.play();
    playBtn.textContent = "â¸";
    highlightText(true);
  }else{
    audio.pause();
    playBtn.textContent = "â–¶";
    highlightText(false);
  }
}

function highlightText(enable){
  const paragraphs = bookDiv.querySelectorAll("p");
  paragraphs.forEach(p=>enable?p.classList.add("highlight"):p.classList.remove("highlight"));
}

speedBtn.addEventListener("click", ()=>{
  speedIndex = (speedIndex +1) % speeds.length;
  audio.playbackRate = speeds[speedIndex];
  speedBtn.textContent = speeds[speedIndex] + "x";
});

function changeTextSize(delta){
  const style = window.getComputedStyle(bookDiv, null).getPropertyValue('font-size');
  const currentSize = parseFloat(style);
  bookDiv.style.fontSize = (currentSize + delta) + 'px';
}

const backgrounds = ['#fdf6e3','#fff','#e0f7fa','#fce4ec','#e8f5e9'];
let bgIndex = 0;
function changeBackground(){ bgIndex=(bgIndex+1)%backgrounds.length; document.body.style.background=backgrounds[bgIndex]; }

function goBack(){ window.location.href="library.html"; }

// ç« èŠ‚åˆ‡æ¢
const urlParams = new URLSearchParams(window.location.search);
let bookFolder = urlParams.get("book");
let chapterNum = urlParams.get("chapter");

function loadChapter(book, num){
  const file = `books/${book}/${num==="cover"?"cover.html":"chapter"+num+".html"}`;
  fetch(file).then(res=>{if(!res.ok) throw new Error("æ‰¾ä¸åˆ°æ–‡ä»¶:"+file); return res.text();})
  .then(html=>{ bookDiv.innerHTML = html; document.getElementById("bookTitle").textContent = `${book} - ${num==="cover"?"å°é¢":"ç¬¬ "+num+" ç« "}`; loadAudio(book,num); })
  .catch(err=>{document.getElementById("error").textContent="âŒ "+err.message;});
}

function loadAudio(book,num){
  const audioFile = `books/${book}/audio/${num==="cover"?"cover":"chapter"+num}.mp3`;
  audio.src = audioFile;
  audio.pause();
  audio.currentTime = 0;
}

function nextChapter(){
  if(chapterNum==="cover") chapterNum=1;
  else chapterNum=parseInt(chapterNum)+1;
  loadChapter(bookFolder,chapterNum);
}

function prevChapter(){
  if(chapterNum==="cover") return;
  chapterNum=parseInt(chapterNum)-1;
  if(chapterNum<1) chapterNum="cover";
  loadChapter(bookFolder,chapterNum);
}

// åˆå§‹åŒ–
if(!bookFolder || !chapterNum){
  document.getElementById("bookTitle").textContent = "æœªé€‰æ‹©ä¹¦ç±";
  bookDiv.innerHTML="<p style='color:red'>âŒ URL ç¼ºå°‘ ?book=åç§° &chapter=æ•°å­—</p>";
}else{ loadChapter(bookFolder,chapterNum); }

</script>
</body>
</html>
